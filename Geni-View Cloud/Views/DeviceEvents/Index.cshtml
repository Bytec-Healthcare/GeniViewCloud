@{
    ViewBag.Title = "Device History";
    ViewBag.ShowCommunityAndGroupFilter = true;
}

@section styles {
    <style>

        /* ===== DEVICE EVENTS BAR ===== */
        .device-events-bar {
            height: 40px;
            background: #E6E9FB;
            border-radius: 6px;
            display: flex;
            align-items: center;
            padding: 0 16px;
        }

        .device-events-title {
            font-family: Instrument Sans, sans-serif;
            font-size: 15px;
            font-weight: 600;
            color: #3E4CC1;
        }

            .device-events-title span {
                font-weight: 500;
                color: #6B7280;
                margin-left: 6px;
            }

        .device-events-actions {
            margin-left: auto;
            display: flex;
            gap: 12px;
        }

        /* ===== CARD CONTAINER (FIGMA MATCH) ===== */
        .device-events-card {
            /*width: 1267px;*/
            width: 1500px;
            background: #FFFFFF;
            border-radius: 18px;
            border: 1px solid rgba(68,68,68,0.4);
            box-shadow: 0 4px 4px rgba(0,0,0,0.25);
            padding: 20px 20px 28px;
            min-height: calc(100vh - 190px);
        }

        .device-events-tablewrap {
            border-radius: 18px;
            border: none;
            /*max-height: 800px;*/
            /*overflow-y: auto;*/
            overflow: visible;
        }

        /* ===== TABLE ===== */
        .device-events-table {
            width: 100%;
            border-collapse: collapse;
        }

            .device-events-table thead th {
                height: 44px; /* was 36px */
                padding: 0 16px;
                line-height: 1.2;
                font-size: 18px;
                font-weight: 700;
                color: #2F2F2F;
                border-bottom: 1px solid rgba(68,68,68,0.4);
                text-align: left;
            }

            .device-events-table tbody td {
                /* CHANGE: loosen row spacing */
                height: 44px; /* was 36px */
                padding: 0 16px;
                line-height: 1.2; /* add */
                font-size: 18px;
                font-weight: 500;
                color: #4B5563;
                vertical-align: middle;
            }

        /* ===== COLUMN WIDTHS (FROM FIGMA) ===== */
        .col-serial {
            width: 185px;
        }

        .col-desc {
            width: 101px;
        }

        .col-type {
            width: 124px;
        }

        .col-source {
            width: 61px;
        }

        .col-time {
            width: 193px;
            text-align: right;
        }

        /* ===== ICON + TEXT ===== */
        .cell-flex {
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .icon-device {
            flex-shrink: 0;
        }

        .icon-info {
            flex-shrink: 0;
        }


        /* ===== Device Events Table ===== */

        .device-events-table {
            width: 100%;
            border-collapse: collapse;
        }

            /* Prevent wrapping */
            .device-events-table td,
            .device-events-table th {
                white-space: nowrap;
                vertical-align: middle;
                /*font-size: 13px;*/
            }

        /* Icon + text layout */
        .cell-flex {
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        /* Device icon (exact Figma size) */
        .icon-device {
            width: 20px;
            height: 21.67px;
            flex-shrink: 0;
        }

        /* Info icon (exact Figma size) */
        .icon-info {
            width: 6.43px;
            height: 16px;
            flex-shrink: 0;
        }

        /* Text next to icons */
        .cell-flex span {
            line-height: 1;
            display: inline-block;
        }

        /* ===== DATATABLES FOOTER ===== */
        .dt-footer {
            width: 100%;
            box-sizing: border-box;
            margin-top: 8px; /* small gap so footer doesn't "touch" the table */
        }

        .dataTables_info {
            font-size: 12px;
            color: #6B7280;
        }

        .paginate_button {
            min-width: 28px;
            height: 28px;
            padding: 0 8px !important;
            border-radius: 4px;
            border: 1px solid rgba(62,76,193,0.35) !important;
            background: #FFFFFF !important;
            color: #3E4CC1 !important;
            font-weight: 600;
            font-size: 12px;
        }

            .paginate_button.current {
                background: rgba(62,76,193,0.12) !important;
            }

        .dt-footer {
            display: flex;
            align-items: center;
            justify-content: space-between; /* info left, pager right */
            width: 100%;
            box-sizing: border-box;
            margin-top: 10px; /* gap so it doesn't touch table */
            padding: 8px 12px;
            border-top: 1px solid rgba(68,68,68,0.20);
        }

        .dt-info {
            color: #6B7280;
            font-size: 12px;
            white-space: nowrap;
        }

        .dt-pager {
            white-space: nowrap;
        }
    </style>
}

@section scripts {
    <script>

    var refreshMs = 10000;
    var refreshTimer;

    function loadDeviceEvents() {
        $.get('@Url.Action("GetDeviceEventHistory", "DeviceEvents")', function (html) {
            $('#DeviceEventHistory').html(html);
        }).always(scheduleRefresh);
    }

    function scheduleRefresh() {
        clearTimeout(refreshTimer);
        refreshTimer = setTimeout(loadDeviceEvents, refreshMs);
    }

    $(document).ready(loadDeviceEvents);

    </script>
}

<div class="device-events-bar">
    <div class="device-events-title">
        Device Events <span>(Latest 50)</span>
    </div>
    <div class="device-events-actions">
        <i class="fa fa-sync" onclick="location.reload()"></i>
        <i class="fa fa-bell"></i>
    </div>
</div>

<div style="height:12px"></div>

<div class="device-events-card">
    <div class="device-events-tablewrap">
        <div id="DeviceEventHistory"></div>
    </div>
</div>
