@{
    ViewBag.Title = "Dashboard";
    ViewBag.ShowCommunityAndGroupFilter = true;
}

@section styles {
    <style>
        /* Page-scoped fallback styles to ensure the widget is never plain text */
        #dashboard-canvas.dashboard-v2 .dashboard-v2__grid { display: flex; flex-wrap: wrap; gap: 18px; }
        #dashboard-canvas.dashboard-v2 .cycle-widget { background:#fff; border-radius:12px; box-shadow:0 2px 14px rgba(15,23,42,.08); padding:18px; width:520px; max-width:100%; }

        /* Widget header */
        #dashboard-canvas.dashboard-v2 .cycle-widget__top { display:flex; align-items:flex-start; justify-content:space-between; gap:10px; }
        #dashboard-canvas.dashboard-v2 .cycle-widget__top-left { min-width: 0; }
        #dashboard-canvas.dashboard-v2 .cycle-widget__top-right { flex: 0 0 auto; }
        #dashboard-canvas.dashboard-v2 .cycle-widget__corner-icon {
            width: 32px;
            height: 32px;
            border-radius: 10px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background: rgba(79, 70, 229, 0.12);
            color: #4F46E5;
        }
        #dashboard-canvas.dashboard-v2 .cycle-widget__corner-icon i { font-size: 14px; }

        #dashboard-canvas.dashboard-v2 .cycle-widget__title { font-weight:700; font-size:14px; color:#111827; }
        #dashboard-canvas.dashboard-v2 .cycle-widget__subtitle { font-size:12px; color:#6b7280; margin-top:2px; }
        #dashboard-canvas.dashboard-v2 .cycle-widget__metric { display:flex; align-items:baseline; gap:10px; margin:12px 0; }
        #dashboard-canvas.dashboard-v2 .cycle-widget__metric-value { font-weight:700; font-size:28px; color:#111827; }
        #dashboard-canvas.dashboard-v2 .cycle-widget__metric-label { font-size:12px; color:#6b7280; }
        #dashboard-canvas.dashboard-v2 .cycle-widget__bar { width:100%; height:10px; border-radius:999px; background:#eef2ff; overflow:hidden; display:flex; }
        #dashboard-canvas.dashboard-v2 .cycle-widget__bar-seg--active { background:#4F46E5; }
        #dashboard-canvas.dashboard-v2 .cycle-widget__bar-seg--idle { background:#FBBF24; }
        #dashboard-canvas.dashboard-v2 .cycle-widget__bar-seg--svc { background:#EF4444; }
        #dashboard-canvas.dashboard-v2 .cycle-widget__stats { margin-top:14px; display:grid; grid-template-columns:repeat(3,1fr); gap:10px; }
        #dashboard-canvas.dashboard-v2 .cycle-widget__stat { background:#f8fafc; border-radius:10px; padding:10px 12px; text-align:center; }
        #dashboard-canvas.dashboard-v2 .cycle-widget__stat-name { font-size:10px; font-weight:700; letter-spacing:.08em; color:#6b7280; display:flex; align-items:center; justify-content:center; gap:6px; }
        #dashboard-canvas.dashboard-v2 .cycle-widget__stat-value { margin-top:6px; font-size:18px; font-weight:700; color:#111827; }

        /* Welcome header tweaks */
        #dashboard-canvas.dashboard-v2 .dashboard-v2__welcome { font-weight: 800; font-size: 22px; color:#111827; }
        #dashboard-canvas.dashboard-v2 .dashboard-v2__welcome-name { font-weight: 800; }

        /* Small icons for ACTIVE/IDLE/SVC */
        #dashboard-canvas.dashboard-v2 .cycle-widget__stat-icon { font-size: 12px; }
        #dashboard-canvas.dashboard-v2 .cycle-widget__stat-icon--active { color:#4F46E5; }
        #dashboard-canvas.dashboard-v2 .cycle-widget__stat-icon--idle { color:#F59E0B; }
        #dashboard-canvas.dashboard-v2 .cycle-widget__stat-icon--svc { color:#EF4444; }
    </style>
}

<div class="row">
    <div class="col-md-12">
        <div id="dashboard-canvas" class="dashboard-v2">
            <div class="dashboard-v2__header">
                <div class="dashboard-v2__welcome">Welcome back, <span class="dashboard-v2__welcome-name">Admin</span></div>
                <div class="dashboard-v2__sub">Here is the latest update on your device network.</div>
            </div>

            <div class="dashboard-v2__grid">
                @Html.Partial("Widgets/_CycleStatusWidget")
            </div>
        </div>
    </div>
</div>

@section scripts {
    <script src="@Url.Content("~/Scripts/dashboard/widgets/cycle-status.js")"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            if (window.DashboardWidgets && window.DashboardWidgets.CycleStatus) {
                window.DashboardWidgets.CycleStatus.init({
                    url: '@Url.Action("GetCycleStatus", "Dashboard")'
                });
            }
        });
    </script>
}