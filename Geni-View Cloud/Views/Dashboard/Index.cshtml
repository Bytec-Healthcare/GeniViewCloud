@{
    ViewBag.Title = "Dashboard";
    ViewBag.ShowCommunityAndGroupFilter = true;
}

@section styles {
    <style>
        #dashboard-canvas.dashboard-v2 .dashboard-v2__grid { display: flex; flex-wrap: wrap; gap: 18px; }

        /* State of Charge widget */
        #dashboard-canvas.dashboard-v2 .soc-status {
            background: #fff;
            border-radius: 14px;
            box-shadow: 0 6px 20px rgba(15, 23, 42, .08);
            padding: 18px 18px 16px;
            width: 460px;
            max-width: 100%;
        }

        #dashboard-canvas.dashboard-v2 .soc-status__header {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            gap: 12px;
        }

        #dashboard-canvas.dashboard-v2 .soc-status__header-left { min-width: 0; }

        #dashboard-canvas.dashboard-v2 .soc-status__title-row {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        #dashboard-canvas.dashboard-v2 .soc-status__title-icon {
            width: 36px;
            height: 36px;
            border-radius: 10px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background: #dcfce7; /* light green */
            color: #16a34a;      /* green */
            flex: 0 0 auto;
        }

        #dashboard-canvas.dashboard-v2 .soc-status__title-icon i { font-size: 16px; }
        #dashboard-canvas.dashboard-v2 .soc-status__title { font-weight: 800; font-size: 18px; color: #111827; line-height: 1.1; }
        #dashboard-canvas.dashboard-v2 .soc-status__subtitle { margin-top: 6px; font-size: 12px; color: #6b7280; }

        #dashboard-canvas.dashboard-v2 .soc-status__header-right { text-align: right; }
        #dashboard-canvas.dashboard-v2 .soc-status__avg-value { font-weight: 900; font-size: 22px; color: #111827; line-height: 1; }
        #dashboard-canvas.dashboard-v2 .soc-status__avg-label { margin-top: 3px; font-size: 11px; color: #6b7280; line-height: 1.1; }

        #dashboard-canvas.dashboard-v2 .soc-status__bar {
            margin-top: 14px;
            height: 10px;
            width: 100%;
            border-radius: 999px;
            overflow: hidden;
            background: #f3f4f6;
            display: flex;
        }

        #dashboard-canvas.dashboard-v2 .soc-status__bar-seg { height: 100%; }
        #dashboard-canvas.dashboard-v2 .soc-status__bar-seg--high { background: #22c55e; }
        #dashboard-canvas.dashboard-v2 .soc-status__bar-seg--low { background: #fbbf24; }
        #dashboard-canvas.dashboard-v2 .soc-status__bar-seg--charge { background: #f97316; }

        #dashboard-canvas.dashboard-v2 .soc-status__cards {
            margin-top: 14px;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }

        #dashboard-canvas.dashboard-v2 .soc-status__card {
            border: 1px solid #e5e7eb;
            border-radius: 10px;
            padding: 12px 10px;
            text-align: center;
            background: #fff;
        }

        #dashboard-canvas.dashboard-v2 .soc-status__card-icon {
            width: 32px;
            height: 32px;
            border-radius: 10px;
            margin: 0 auto 8px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background: #f3f4f6;
        }

        #dashboard-canvas.dashboard-v2 .soc-status__card-icon--high { color: #16a34a; background: rgba(34, 197, 94, .14); }
        #dashboard-canvas.dashboard-v2 .soc-status__card-icon--low { color: #d97706; background: rgba(251, 191, 36, .18); }
        #dashboard-canvas.dashboard-v2 .soc-status__card-icon--charge { color: #ea580c; background: rgba(249, 115, 22, .18); }

        #dashboard-canvas.dashboard-v2 .soc-status__card-icon i { font-size: 16px; }
        #dashboard-canvas.dashboard-v2 .soc-status__card-value { font-weight: 900; font-size: 20px; color: #111827; line-height: 1; }
        #dashboard-canvas.dashboard-v2 .soc-status__card-label { margin-top: 6px; font-size: 12px; color: #374151; font-weight: 700; }

        /* Cycle Status widget (UX-matching) */
        #dashboard-canvas.dashboard-v2 .cycle-status {
            background: #fff;
            border-radius: 14px;
            box-shadow: 0 6px 20px rgba(15, 23, 42, .08);
            padding: 18px 18px 16px;
            width: 460px;
            max-width: 100%;
        }

        #dashboard-canvas.dashboard-v2 .cycle-status__header {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            gap: 12px;
        }

        #dashboard-canvas.dashboard-v2 .cycle-status__title-row {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        #dashboard-canvas.dashboard-v2 .cycle-status__title-icon {
            width: 36px;
            height: 36px;
            border-radius: 10px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background: #dbeafe; /* light blue */
            color: #1d4ed8;      /* blue */
            flex: 0 0 auto;
        }

        #dashboard-canvas.dashboard-v2 .cycle-status__title-icon i { font-size: 16px; }
        #dashboard-canvas.dashboard-v2 .cycle-status__title { font-weight: 800; font-size: 18px; color: #111827; line-height: 1.1; }
        #dashboard-canvas.dashboard-v2 .cycle-status__subtitle { margin-top: 6px; font-size: 12px; color: #6b7280; }

        #dashboard-canvas.dashboard-v2 .cycle-status__header-right { text-align: right; }
        #dashboard-canvas.dashboard-v2 .cycle-status__avg-value { font-weight: 900; font-size: 22px; color: #111827; line-height: 1; }
        #dashboard-canvas.dashboard-v2 .cycle-status__avg-label { margin-top: 3px; font-size: 11px; color: #6b7280; line-height: 1.1; }

        #dashboard-canvas.dashboard-v2 .cycle-status__bar {
            margin-top: 14px;
            height: 10px;
            width: 100%;
            border-radius: 999px;
            overflow: hidden;
            background: #f3f4f6;
            display: flex;
        }

        #dashboard-canvas.dashboard-v2 .cycle-status__bar-seg { height: 100%; }
        #dashboard-canvas.dashboard-v2 .cycle-status__bar-seg--low { background: #22c55e; }
        #dashboard-canvas.dashboard-v2 .cycle-status__bar-seg--high { background: #fbbf24; }
        #dashboard-canvas.dashboard-v2 .cycle-status__bar-seg--eol { background: #f97316; }

        #dashboard-canvas.dashboard-v2 .cycle-status__cards {
            margin-top: 14px;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }

        #dashboard-canvas.dashboard-v2 .cycle-status__card {
            border: 1px solid #e5e7eb;
            border-radius: 10px;
            padding: 12px 10px;
            text-align: center;
            background: #fff;
        }

        #dashboard-canvas.dashboard-v2 .cycle-status__card-icon {
            width: 32px;
            height: 32px;
            border-radius: 10px;
            margin: 0 auto 8px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background: #f3f4f6;
        }

        #dashboard-canvas.dashboard-v2 .cycle-status__card-icon--low { color: #16a34a; background: rgba(34, 197, 94, .14); }
        #dashboard-canvas.dashboard-v2 .cycle-status__card-icon--high { color: #d97706; background: rgba(251, 191, 36, .18); }
        #dashboard-canvas.dashboard-v2 .cycle-status__card-icon--eol { color: #ea580c; background: rgba(249, 115, 22, .18); }

        #dashboard-canvas.dashboard-v2 .cycle-status__card-icon i { font-size: 16px; }

        #dashboard-canvas.dashboard-v2 .cycle-status__card-value { font-weight: 900; font-size: 20px; color: #111827; line-height: 1; }
        #dashboard-canvas.dashboard-v2 .cycle-status__card-label { margin-top: 6px; font-size: 12px; color: #374151; font-weight: 700; }

        /* Welcome header tweaks */
        #dashboard-canvas.dashboard-v2 .dashboard-v2__welcome { font-weight: 800; font-size: 22px; color:#111827; }
        #dashboard-canvas.dashboard-v2 .dashboard-v2__welcome-name { font-weight: 800; }
    </style>
}

<div class="row">
    <div class="col-md-12">
        <div id="dashboard-canvas" class="dashboard-v2">
            <div class="dashboard-v2__header">
                <div class="dashboard-v2__welcome">Welcome back, <span class="dashboard-v2__welcome-name">Admin</span></div>
                <div class="dashboard-v2__sub">Here is the latest update on your device network.</div>
            </div>

            <div class="dashboard-v2__grid">
                @Html.Partial("Widgets/_StateOfChargeWidget")
                @Html.Partial("Widgets/_CycleStatusWidget")
            </div>
        </div>
    </div>
</div>

@section scripts {
    <script src="@Url.Content("~/Scripts/dashboard/widgets/state-of-charge.js")"></script>
    <script src="@Url.Content("~/Scripts/dashboard/widgets/cycle-status.js")"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            if (window.DashboardWidgets && window.DashboardWidgets.StateOfCharge) {
                window.DashboardWidgets.StateOfCharge.init({
                    url: '@Url.Action("GetStateOfCharge", "Dashboard")'
                });
            }

            if (window.DashboardWidgets && window.DashboardWidgets.CycleStatus) {
                window.DashboardWidgets.CycleStatus.init({
                    url: '@Url.Action("GetCycleStatus", "Dashboard")'
                });
            }
        });
    </script>
}