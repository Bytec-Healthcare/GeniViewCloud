@model GeniView.Cloud.Models.ApplicationUser
@{
    ViewBag.Title = "Profile";
}

@section scripts{
    <script>
    $("#imageChangeBox").click(function (e) {
        $("#imageUpload").click();
    });

    $("#imageUpload").change(function () {
        if (this.files && this.files[0]) {
            var reader = new FileReader();
            reader.onload = function (e) {
                $('#profileImage').attr('src', e.target.result);
            }
            reader.readAsDataURL(this.files[0]);
        }
    });

    var sm = '@(TempData["Success"])';
    var fm = '@(TempData["Fail"])';
    alertify.set('notifier', 'position', 'bottom-right');
    if (sm) {
        alertify.success(sm);
    }
    if (fm) {
        alertify.error(fm);
    }
    </script>
}

@using (Html.BeginForm("Index", "Profile", FormMethod.Post, new { enctype = "multipart/form-data" }))
{
    <div class="row">
        <div class="panel maincontainer">
            <div class="panel-heading">@ViewBag.Title</div>
            <div class="panel-body">
                @Html.AntiForgeryToken()

                <div class="form-horizontal">
                    @Html.ValidationSummary(true, "", new { @class = "text-danger" })
                    <p>@Html.ValidationMessage("DbFail", new { @class = "text-danger" })</p>
                    <div class="form-group">
                        @Html.Label("Profile Photo", new { @class = "control-label col-md-2" })
                        <div class="col-md-10">
                            <div class="image-container" id="imageChangeBox">
                                <div class="inside-box">Change</div>
                                <img class="img-circle" id="profileImage" src="@Url.Action("GetProfileImage", "Profile")" />
                            </div>
                            <input name="Image" id="imageUpload" type="file" style="display:none;" />
                        </div>
                    </div>
                    <div class="form-group">
                        @Html.Label("Full Name", htmlAttributes: new { @class = "control-label col-md-2" })
                        <div class="col-md-10">
                            @Html.EditorFor(model => model.FullName, new { htmlAttributes = new { @class = "form-control" } })
                            @Html.ValidationMessageFor(model => model.FullName, "", new { @class = "text-danger" })
                        </div>
                    </div>

                    <div class="form-group">
                        @Html.LabelFor(model => model.Email, htmlAttributes: new { @class = "control-label col-md-2" })
                        <div class="col-md-10">
                            @Html.EditorFor(model => model.Email, new { htmlAttributes = new { @class = "form-control" } })
                            @Html.ValidationMessageFor(model => model.Email, "", new { @class = "text-danger" })
                        </div>
                    </div>

                    <div class="form-group">
                        @Html.Label("Email Notifications", htmlAttributes: new { @class = "control-label col-md-2" })
                        <div class="col-md-10">
                            <label class="control-label">
                                @Html.CheckBoxFor(model => model.IsNotificationEnable, new { @checked = "checked", htmlAttributes = new { @class = "checkbox" } })
                            </label>
                        </div>
                    </div>

                    <div class="form-group">
                        @Html.Label("Role", htmlAttributes: new { @class = "control-label col-md-2" })
                        <div class="col-md-10">
                            <label class="form-control-static"> @ViewBag.RoleName </label>
                        </div>
                    </div>
                    @if (User.IsInRole("Community Admin") || User.IsInRole("Community Group Admin") || User.IsInRole("Community User"))
                    {
                        <div class="form-group">
                            @Html.Label("Community", htmlAttributes: new { @class = "control-label col-md-2" })
                            <div class="col-md-10">
                                <label class="form-control-static"> @ViewBag.Community </label>
                            </div>
                        </div>

                        <div class="form-group">
                            @Html.Label("Group(s)", htmlAttributes: new { @class = "control-label col-md-2" })
                            <div class="col-md-10">
                                <select multiple size="@ViewBag.GroupsCount" class="form-control" disabled style="cursor:default; background-color:#FFF; color:black;">
                                    @foreach(var group in @ViewBag.Groups){
                                        <option>@group.Name</option>
                                    }
                                </select>

                            </div>
                        </div>
                    }
                    <div class="form-group">
                        @Html.Label("Timezone", htmlAttributes: new { @class = "control-label col-md-2" })
                        <div class="col-md-10">
                            @Html.DropDownListFor(model => model.TimeZoneId, new SelectList(ViewBag.TimeZones, "ID", "DisplayText"), htmlAttributes: new { @class = "form-control" })
                        </div>
                    </div>
                    <div class="form-group">
                        @Html.Label("Theme", htmlAttributes: new { @class = "control-label col-md-2" })
                        <div class="col-md-10">
                            <select class="form-control" id="select-theme" onchange="SelectTheme(this)">
                                <option value="old-theme">Navy Theme</option>
                                <option value="light-theme">Light Theme</option>
                                <option value="dark-theme">Dark Theme</option>
                                <option value="mix-theme">Mixed Theme</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        @Html.Label("Password", htmlAttributes: new { @class = "control-label col-md-2" })
                        <div class="col-md-10">
                            @Html.ActionLink("Change password", "ChangePassword", null, new { @class = "btn btn-default" })
                            <input type="submit" value="Save Changes" class="btn btn-default" />
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
}